<!DOCTYPE html><html lang="zh-HK" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>ESP32-S3 與心跳和血氧測試 | 一個在成長路上前行的人</title><meta name="author" content="Victor999p"><meta name="copyright" content="Victor999p"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="這是 ESP32-S3 的第一篇操作記錄，從環境設定到 LED 閃爍的完整步驟。"><meta property="og:type" content="article"><meta property="og:title" content="ESP32-S3 與心跳和血氧測試"><meta property="og:url" content="https://victor999p.github.io/posts/c2e18503.html"><meta property="og:site_name" content="一個在成長路上前行的人"><meta property="og:description" content="這是 ESP32-S3 的第一篇操作記錄，從環境設定到 LED 閃爍的完整步驟。"><meta property="og:locale" content="zh_HK"><meta property="og:image" content="https://victor999p.github.io/img/vertin_2.jpg"><meta property="article:published_time" content="2025-10-01T09:55:00.000Z"><meta property="article:modified_time" content="2025-10-05T06:45:24.911Z"><meta property="article:author" content="Victor999p"><meta property="article:tag" content="ESP32-S3"><meta property="article:tag" content="Arduino"><meta property="article:tag" content="入門"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://victor999p.github.io/img/vertin_2.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ESP32-S3 與心跳和血氧測試",
  "url": "https://victor999p.github.io/posts/c2e18503.html",
  "image": "https://victor999p.github.io/img/vertin_2.jpg",
  "datePublished": "2025-10-01T09:55:00.000Z",
  "dateModified": "2025-10-05T06:45:24.911Z",
  "author": [
    {
      "@type": "Person",
      "name": "Victor999p",
      "url": "https://victor999p.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/vertin.gif"><link rel="canonical" href="https://victor999p.github.io/posts/c2e18503.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" sizes="180x180" href="/img/vertin.gif"><link rel="icon" type="image/png" sizes="32x32" href="/img/vertin.gif"><link rel="icon" type="image/png" sizes="16x16" href="/img/vertin.gif"><link rel="mask-icon" href="/img/vertin.gif" color="#5bbad5"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><script>(() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到相關內容：${query}","hits_stats":"找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '複製成功',
    error: '複製失敗',
    noSupport: '瀏覽器不支援'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '剛剛',
    min: '分鐘前',
    hour: '小時前',
    day: '天前',
    month: '個月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切換為繁體中文","cht_to_chs":"已切換為簡體中文","day_to_night":"已切換為深色模式","night_to_day":"已切換為淺色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加載更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"ESP32-S3 與心跳和血氧測試",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/clock.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/css/runtime/runtime.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload='this.media="all"'><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="一個在成長路上前行的人" type="application/atom+xml"></head><body><div id="web_bg" style="background-image:url(/img/37_4.jpg)"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/vertin.gif" onerror='this.onerror=null,this.src="/img/vertin.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>歸檔</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分類</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-list"></i> <span>清單</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音樂</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-video"></i> <span>追番</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>連結</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>關於</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/vertin_2.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">一個在成長路上前行的人</span></a><a class="nav-page-title" href="/"><span class="site-name">ESP32-S3 與心跳和血氧測試</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i> <span>返回首頁</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜尋</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>歸檔</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分類</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-list"></i> <span>清單</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音樂</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-video"></i> <span>追番</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>連結</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-envelope"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>關於</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ESP32-S3 與心跳和血氧測試</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">發表於</span><time class="post-meta-date-created" datetime="2025-10-01T09:55:00.000Z" title="發表於 2025-10-01 17:55:00">2025-10-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新於</span><time class="post-meta-date-updated" datetime="2025-10-05T06:45:24.911Z" title="更新於 2025-10-05 14:45:24">2025-10-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%A1%AC%E9%AB%94%E6%93%8D%E4%BD%9C/">硬體操作</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">瀏覽量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><details open>參考 NMKING - ESP32與MAX30102血氧感測 - by 小霸王實驗室in ESP32on Posted on2023/03/26 https://www.nmking.io/index.php/2023/03/26/1071/<summary><b>MAX30102 血氧與心率感測器重點整理</b></summary><div class="note info">我們可以將 <b>MAX30102（脈搏血氧和心率感測器）</b> 連接到相同的 I2C 匯流排。MAX30102 是 I2C 裝置（預設地址 <code>0x57</code>），使用紅外線和紅光 LED 測量心率（BPM）和血氧飽和度（SpO2）。這適合 DIY 健康監測項目，但請注意：<b>這不是醫療級設備</b>，讀數受運動、指頭放置等影響，僅供學習用。</div><div class="note info">我們將使用 <b>SparkFun MAX3010x Sensor Library</b>（支援 MAX30102），它包含心率計算演算法。以下是完整指南，包括接線、庫安裝和基本範例程式碼（測量心率和 SpO2）。</div>**所需元件：**</details><pre><code>- ESP32-WROOM-32 開發板
- MAX30102 模組（通常帶指夾或貼片）
- 0.96 OLED SSD1106 推薦使用SSD1306
- 杜邦線
- USB 線（用於程式上傳）
</code></pre><h1 id="ESP32-S3-入門：安裝環境與-Hello-World"><a href="#ESP32-S3-入門：安裝環境與-Hello-World" class="headerlink" title="ESP32-S3 入門：安裝環境與 Hello World"></a>ESP32-S3 入門：安裝環境與 Hello World</h1><p>ESP32-S3 是 Espressif 的旗艦 MCU，支援 Wi-Fi、Bluetooth 5.0 和 AI 加速，適合 IoT 專案。這篇記錄詳細說明如何安裝開發環境，並運行簡單的 Hello World 程式（LED 閃爍）。</p><h2 id="步驟-1-硬體準備"><a href="#步驟-1-硬體準備" class="headerlink" title="步驟 1: 硬體準備"></a>步驟 1: 硬體準備</h2><ul><li><strong>開發板</strong>：推薦 ESP32-S3-DevKitC-1（約 NT$300）。</li><li><strong>工具</strong>：USB 線、電腦（Windows/Mac/Linux）。</li><li><strong>連接</strong>：USB 連接到電腦，確認驅動程式（CP210x 或 CH340）已安裝。</li></ul><p><image-card alt="ESP32-S3 開發板" src="https://docs.espressif.com/projects/esp-idf/en/latest/esp32s3/_images/esp32-s3-devkitc-1-v1-00-front.jpg">&lt;/image-card&gt;<br><em>(圖片來源：Espressif 官方文件)</em></image-card></p><h2 id="步驟-2-安裝-Arduino-IDE"><a href="#步驟-2-安裝-Arduino-IDE" class="headerlink" title="步驟 2: 安裝 Arduino IDE"></a>步驟 2: 安裝 Arduino IDE</h2><ol><li>下載 Arduino IDE 2.x：<a target="_blank" rel="noopener" href="https://www.arduino.cc/en/software">Arduino 官網</a>。</li><li>在 <strong>檔案 &gt; 偏好設定</strong> 添加 ESP32 板子 URL：</li><li>在 <strong>工具 &gt; 板子 &gt; 板子管理員</strong> 搜尋 “ESP32”，安裝 Espressif 的 ESP32 套件（v2.0.3+ 支援 S3）。</li><li>選擇板子：<strong>工具 &gt; 板子 &gt; ESP32 Arduino &gt; ESP32S3 Dev Module</strong>。</li></ol><h2 id="步驟-3-程式碼範例-Hello-World"><a href="#步驟-3-程式碼範例-Hello-World" class="headerlink" title="步驟 3: 程式碼範例 - Hello World!"></a>步驟 3: 程式碼範例 - Hello World!</h2><p>簡單測試Esp32, 以下是程式碼：<br></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Serial.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Serial.<span class="built_in">println</span>(<span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line"><span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="步驟-4-與MAX30102-和-SSD1106-OLED-的整合"><a href="#步驟-4-與MAX30102-和-SSD1106-OLED-的整合" class="headerlink" title="步驟 4: 與MAX30102 和 SSD1106 OLED 的整合"></a>步驟 4: 與MAX30102 和 SSD1106 OLED 的整合</h2><ul><li>目標<ul><li>使用 ESP32-WROOM-32 將 MAX30102 脈搏血氧感測器和 SSD1306 OLED 顯示器（128x64，I2C 介面）連接到一起，並在 OLED 上顯示心率（BPM）和血氧飽和度（SpO2），使用 Adafruit SSD1306 函式庫的 println 方法輸出英文文字（例如 “Heart Rate: [BPM]” 和 “SpO2: [SpO2]%”）。un</li></ul></li></ul><h3 id="程式碼解釋"><a href="#程式碼解釋" class="headerlink" title="程式碼解釋"></a>程式碼解釋</h3><h4 id="1-硬體連線"><a href="#1-硬體連線" class="headerlink" title="1. 硬體連線"></a>1. 硬體連線</h4><pre><code>- SSD1306 OLED 和 MAX30102 共用 I2C 匯流排，連接到 ESP32 的 GPIO16 (SDA) 和 GPIO17 (SCL)。
- 電源使用 3.3V。
- 連線表如下：
</code></pre><div class="table-container"><table><thead><tr><th>設備</th><th>引腳</th><th>ESP32 引腳</th><th>描述</th></tr></thead><tbody><tr><td>SSD1106 OLED</td><td>VCC</td><td>3.3V</td><td>電源（3.3V）</td></tr><tr><td></td><td>GND</td><td>GND</td><td>接地</td></tr><tr><td></td><td>SCL</td><td>GPIO17</td><td>I2C 時鐘線</td></tr><tr><td></td><td>SDA</td><td>GPIO16</td><td>I2C 資料線</td></tr><tr><td>MAX30102</td><td>VIN</td><td>3.3V</td><td>電源（3.3V）</td></tr><tr><td></td><td>GND</td><td>GND</td><td>接地（共用）</td></tr><tr><td></td><td>SCL</td><td>GPIO17</td><td>I2C 時鐘線（共用）</td></tr><tr><td></td><td>SDA</td><td>GPIO16</td><td>I2C 資料線（共用）</td></tr><tr><td></td><td>INT</td><td>未連接</td><td>中斷引腳（可選）</td></tr></tbody></table></div><ul><li>注意：<ul><li>確保所有設備共用 GND（接地）。</li><li>如果 I2C NACK 錯誤持續發生，請在 SDA (GPIO16) 和 SCL (GPIO17) 各接一個 4.7kΩ 上拉電阻到 3.3V。部分模組內建上拉電阻，但外部電阻通常能提高穩定性。</li><li>使用短杜邦線以減少信號干擾。</li><li>MAX30102 測量時，手指需完全覆蓋感測器，避免移動或環境光干擾。</li></ul></li></ul><h4 id="2-程式碼結構"><a href="#2-程式碼結構" class="headerlink" title="2. 程式碼結構"></a>2. 程式碼結構</h4><p><strong>使用說明</strong><br>OLED屏幕測試：<br>線路連接：</p><pre><code>- GND =&gt; GND
- 3V3 =&gt; VCC
- IO16 =&gt; SDA
- IO17 =&gt; SCL
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/esp32/esp32_hw.jpg" alt="ESP32 硬體連線示意圖"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;Wire.h&gt;</span><br><span class="line">#include &lt;Adafruit_GFX.h&gt;</span><br><span class="line">#include &lt;Adafruit_SSD1306.h&gt;</span><br><span class="line"></span><br><span class="line">#define SCREEN_WIDTH 128  // OLED寬度（像素）</span><br><span class="line">#define SCREEN_HEIGHT 64  // OLED高度（像素）</span><br><span class="line">#define OLED_RESET -1     // 重置引腳（未使用，設為-1）</span><br><span class="line">// GND =&gt; GND</span><br><span class="line">// 3V3 =&gt; VCC</span><br><span class="line">//IO16 =&gt; SDA</span><br><span class="line">//IO17 =&gt;SCL</span><br><span class="line">// 創建顯示器物件，I2C地址為0x3C</span><br><span class="line">Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &amp;Wire, OLED_RESET);</span><br><span class="line"></span><br><span class="line">void setup() &#123;</span><br><span class="line">  Serial.begin(115200);  // 用於除錯</span><br><span class="line"></span><br><span class="line">  // 初始化I2C，使用自訂引腳（SDA=16, SCL=17）</span><br><span class="line">  Wire.begin(16, 17);</span><br><span class="line"></span><br><span class="line">  // 初始化顯示器</span><br><span class="line">  if (!display.begin(SSD1306_SWITCHCAPVCC, 0x3C)) &#123;</span><br><span class="line">    Serial.println(F(&quot;SSD1306初始化失敗&quot;));</span><br><span class="line">    for (;;);  // 初始化失敗則停止</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 清空顯示緩衝區</span><br><span class="line">  display.clearDisplay();</span><br><span class="line">  display.setTextSize(2);           // 設置文字大小</span><br><span class="line">  display.setTextColor(SSD1306_WHITE);  // 設置文字顏色為白色</span><br><span class="line">  display.setCursor(0, 0);         // 從左上角開始</span><br><span class="line">  display.println(&quot;Hello world!&quot;);  // 顯示中文文字</span><br><span class="line">  display.display();               // 輸出到螢幕</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop() &#123;</span><br><span class="line">  // 空迴圈；可在此添加動態更新程式碼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>源代碼修改：</p><ul><li>添加 <code>Wire.begin(16, 17);</code> 和 <code>Wire.setClock(100000);</code></li><li>移除所有蜂鳴器相關程式碼</li><li>添加初始化除錯訊息</li><li>確保與 Adafruit SSD1306 (2.4.6) 和 SparkFun MAX3010x 相容</li><li>驗證函式庫版本：<ul><li>Adafruit SSD1306: 2.4.6</li><li>Adafruit GFX: 1.10.12</li><li>SparkFun MAX3010x: 任意版本（包含 heartRate.h）</li></ul></li></ul><p>上傳程式碼：</p><ol><li>在 Arduino IDE 中選擇 ESP32 Dev Module 和正確的序列埠。</li><li>上傳上述程式碼。</li></ol><p>檢查序列監視器：</p><ol><li>打開序列監視器（115200 波特率），確認初始化訊息（例如 “SSD1306 初始化成功”）。</li><li>觀察 BPM 和 SpO2 輸出。</li></ol><p>測試感測器：</p><ol><li>將手指輕放在 MAX30102 感測器上（完全覆蓋，避免移動）。</li><li>等待 5-10 秒，OLED 應顯示心跳圖示、”[BPM] BPM” 和氧氣圖示、”[SpO2]%”（若 BPM &gt; 30）。</li><li>若無手指，OLED 顯示 “Finger Please”。</li></ol><p>預期輸出：</p><ul><li>正常成人 BPM：60-100。</li><li>正常 SpO2：95-100%。</li><li>序列監視器顯示類似：<code>Bpm: 75, SpO2: 98.5</code></li></ul><hr><h4 id="3-問題排查"><a href="#3-問題排查" class="headerlink" title="3. 問題排查"></a>3. 問題排查</h4><p><strong>無心率或血氧讀數：</strong></p><ul><li>確保手指正確放置（輕壓，無環境光干擾）。</li><li>調整 ledBrightness（試 50-127，例如 <code>particleSensor.setup(50, ...)</code>）。</li><li>檢查序列監視器：IR &lt; 7000 表示未偵測到手指。</li><li>血氧可能需 30 次採樣（Num）穩定。</li></ul><p><strong>OLED 無顯示或亂碼：</strong></p><ul><li>若無顯示，嘗試 I2C 地址 0x3D（修改 <code>display.begin(SSD1306_SWITCHCAPVCC, 0x3D)</code>）。</li><li>若使用 128x32 OLED，修改 <code>SCREEN_HEIGHT</code> 為 32。</li><li>單獨測試 OLED（使用 artifact ID: e69fa0ab-7c18-4349-a8a4-5ac22e61b0ef 的程式碼）。</li></ul><p><strong>血氧不準確：</strong></p><ul><li>當前公式（<code>SpO2 = -23.3 * (R - 0.4) + 120</code>）為簡化版。若需更高精度，可使用 SparkFun 的 Example6_SPO2（包含 spo2_algorithm.h）。</li><li>確保 <code>ledMode = 2</code>（紅光+紅外線）。</li></ul><hr><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/esp32/esp32_bpm_spo.jpg" alt="ESP32 BPM/SpO2 示意圖"><br></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Wire.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Adafruit_GFX.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Adafruit_SSD1306.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MAX30105.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;heartRate.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SCREEN_WIDTH 128 <span class="comment">// OLED 寬度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SCREEN_HEIGHT 64 <span class="comment">// OLED 高度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OLED_RESET -1 <span class="comment">// 重置引腳</span></span></span><br><span class="line"><span class="function">Adafruit_SSD1306 <span class="title">display</span><span class="params">(SCREEN_WIDTH, SCREEN_HEIGHT, &amp;Wire, OLED_RESET)</span></span>; <span class="comment">// 初始化 OLED</span></span><br><span class="line"></span><br><span class="line">MAX30105 particleSensor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 心率變數</span></span><br><span class="line"><span class="type">const</span> byte RATE_SIZE = <span class="number">4</span>; <span class="comment">// 平均樣本數</span></span><br><span class="line">byte rates[RATE_SIZE]; <span class="comment">// 心率陣列</span></span><br><span class="line">byte rateSpot = <span class="number">0</span>;</span><br><span class="line"><span class="type">long</span> lastBeat = <span class="number">0</span>; <span class="comment">// 上次心跳時間</span></span><br><span class="line"><span class="type">float</span> beatsPerMinute;</span><br><span class="line"><span class="type">int</span> beatAvg;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 血氧變數</span></span><br><span class="line"><span class="type">double</span> avered = <span class="number">0</span>;</span><br><span class="line"><span class="type">double</span> aveir = <span class="number">0</span>;</span><br><span class="line"><span class="type">double</span> sumirrms = <span class="number">0</span>;</span><br><span class="line"><span class="type">double</span> sumredrms = <span class="number">0</span>;</span><br><span class="line"><span class="type">double</span> SpO2 = <span class="number">0</span>;</span><br><span class="line"><span class="type">double</span> ESpO2 = <span class="number">60.0</span>; <span class="comment">// 初始血氧估計值</span></span><br><span class="line"><span class="type">double</span> FSpO2 = <span class="number">0.7</span>; <span class="comment">// 血氧濾波因子</span></span><br><span class="line"><span class="type">double</span> frate = <span class="number">0.95</span>; <span class="comment">// 紅光/紅外線低通濾波</span></span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> Num = <span class="number">30</span>; <span class="comment">// 每 30 次採樣計算一次</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FINGER_ON 7000 <span class="comment">// 手指偵測紅外線最小值</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MINIMUM_SPO2 60.0 <span class="comment">// 血氧最小值</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 小心跳圖示</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> PROGMEM logo2_bmp[] =</span><br><span class="line">&#123; <span class="number">0x03</span>, <span class="number">0xC0</span>, <span class="number">0xF0</span>, <span class="number">0x06</span>, <span class="number">0x71</span>, <span class="number">0x8C</span>, <span class="number">0x0C</span>, <span class="number">0x1B</span>, <span class="number">0x06</span>, <span class="number">0x18</span>, <span class="number">0x0E</span>, <span class="number">0x02</span>, <span class="number">0x10</span>, <span class="number">0x0C</span>, <span class="number">0x03</span>, <span class="number">0x10</span>, </span><br><span class="line">  <span class="number">0x04</span>, <span class="number">0x01</span>, <span class="number">0x10</span>, <span class="number">0x04</span>, <span class="number">0x01</span>, <span class="number">0x10</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0x10</span>, <span class="number">0x40</span>, <span class="number">0x01</span>, <span class="number">0x10</span>, <span class="number">0xC0</span>, <span class="number">0x03</span>, <span class="number">0x08</span>, <span class="number">0x88</span>,</span><br><span class="line">  <span class="number">0x02</span>, <span class="number">0x08</span>, <span class="number">0xB8</span>, <span class="number">0x04</span>, <span class="number">0xFF</span>, <span class="number">0x37</span>, <span class="number">0x08</span>, <span class="number">0x01</span>, <span class="number">0x30</span>, <span class="number">0x18</span>, <span class="number">0x01</span>, <span class="number">0x90</span>, <span class="number">0x30</span>, <span class="number">0x00</span>, <span class="number">0xC0</span>, <span class="number">0x60</span>,</span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x60</span>, <span class="number">0xC0</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x1B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 大心跳圖示</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> PROGMEM logo3_bmp[] =</span><br><span class="line">&#123; <span class="number">0x01</span>, <span class="number">0xF0</span>, <span class="number">0x0F</span>, <span class="number">0x80</span>, <span class="number">0x06</span>, <span class="number">0x1C</span>, <span class="number">0x38</span>, <span class="number">0x60</span>, <span class="number">0x18</span>, <span class="number">0x06</span>, <span class="number">0x60</span>, <span class="number">0x18</span>, <span class="number">0x10</span>, <span class="number">0x01</span>, <span class="number">0x80</span>, <span class="number">0x08</span>,</span><br><span class="line">  <span class="number">0x20</span>, <span class="number">0x01</span>, <span class="number">0x80</span>, <span class="number">0x04</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x40</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0xC0</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x03</span>,</span><br><span class="line">  <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x01</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x18</span>, <span class="number">0x01</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x1C</span>, <span class="number">0x01</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x14</span>, <span class="number">0x00</span>,</span><br><span class="line">  <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x14</span>, <span class="number">0x00</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x14</span>, <span class="number">0x00</span>, <span class="number">0x40</span>, <span class="number">0x10</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x40</span>, <span class="number">0x10</span>, <span class="number">0x12</span>, <span class="number">0x00</span>,</span><br><span class="line">  <span class="number">0x7E</span>, <span class="number">0x1F</span>, <span class="number">0x23</span>, <span class="number">0xFE</span>, <span class="number">0x03</span>, <span class="number">0x31</span>, <span class="number">0xA0</span>, <span class="number">0x04</span>, <span class="number">0x01</span>, <span class="number">0xA0</span>, <span class="number">0xA0</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0xA0</span>, <span class="number">0xA0</span>, <span class="number">0x08</span>,</span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x60</span>, <span class="number">0xE0</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x60</span>, <span class="number">0x20</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x40</span>, <span class="number">0x60</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x40</span>, <span class="number">0xC0</span>,</span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x80</span>, <span class="number">0x01</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0xC0</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x60</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x30</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>,</span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x06</span>, <span class="number">0x60</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0xC0</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x80</span>, <span class="number">0x00</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 氧氣圖示</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> PROGMEM O2_bmp[] = &#123;</span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xf0</span>, <span class="number">0x00</span>, <span class="number">0x3f</span>, <span class="number">0xc3</span>, <span class="number">0xf8</span>, <span class="number">0x00</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xfc</span>,</span><br><span class="line">  <span class="number">0x03</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xfe</span>, <span class="number">0x07</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xfe</span>, <span class="number">0x0f</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0xfe</span>, <span class="number">0x0f</span>, <span class="number">0xff</span>, <span class="number">0xff</span>, <span class="number">0x7e</span>,</span><br><span class="line">  <span class="number">0x1f</span>, <span class="number">0x80</span>, <span class="number">0xff</span>, <span class="number">0xfc</span>, <span class="number">0x1f</span>, <span class="number">0x00</span>, <span class="number">0x7f</span>, <span class="number">0xb8</span>, <span class="number">0x3e</span>, <span class="number">0x3e</span>, <span class="number">0x3f</span>, <span class="number">0xb0</span>, <span class="number">0x3e</span>, <span class="number">0x3f</span>, <span class="number">0x3f</span>, <span class="number">0xc0</span>,</span><br><span class="line">  <span class="number">0x3e</span>, <span class="number">0x3f</span>, <span class="number">0x1f</span>, <span class="number">0xc0</span>, <span class="number">0x3e</span>, <span class="number">0x3f</span>, <span class="number">0x1f</span>, <span class="number">0xc0</span>, <span class="number">0x3e</span>, <span class="number">0x3f</span>, <span class="number">0x1f</span>, <span class="number">0xc0</span>, <span class="number">0x3e</span>, <span class="number">0x3e</span>, <span class="number">0x2f</span>, <span class="number">0xc0</span>,</span><br><span class="line">  <span class="number">0x3e</span>, <span class="number">0x3f</span>, <span class="number">0x0f</span>, <span class="number">0x80</span>, <span class="number">0x1f</span>, <span class="number">0x1c</span>, <span class="number">0x2f</span>, <span class="number">0x80</span>, <span class="number">0x1f</span>, <span class="number">0x80</span>, <span class="number">0xcf</span>, <span class="number">0x80</span>, <span class="number">0x1f</span>, <span class="number">0xe3</span>, <span class="number">0x9f</span>, <span class="number">0x00</span>,</span><br><span class="line">  <span class="number">0x0f</span>, <span class="number">0xff</span>, <span class="number">0x3f</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0xfe</span>, <span class="number">0xfe</span>, <span class="number">0x00</span>, <span class="number">0x0b</span>, <span class="number">0xfe</span>, <span class="number">0x0c</span>, <span class="number">0x00</span>, <span class="number">0x1d</span>, <span class="number">0xff</span>, <span class="number">0xf8</span>, <span class="number">0x00</span>,</span><br><span class="line">  <span class="number">0x1e</span>, <span class="number">0xff</span>, <span class="number">0xe0</span>, <span class="number">0x00</span>, <span class="number">0x1f</span>, <span class="number">0xff</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1f</span>, <span class="number">0xf0</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1f</span>, <span class="number">0xe0</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">  <span class="number">0x0f</span>, <span class="number">0xe0</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x80</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Serial.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;系統啟動&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化 I2C (SDA=16, SCL=17)</span></span><br><span class="line">  Wire.<span class="built_in">begin</span>(<span class="number">16</span>, <span class="number">17</span>);</span><br><span class="line">  Wire.<span class="built_in">setClock</span>(<span class="number">100000</span>); <span class="comment">// 100kHz 穩定性</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化 OLED</span></span><br><span class="line">  <span class="keyword">if</span> (!display.<span class="built_in">begin</span>(SSD1306_SWITCHCAPVCC, <span class="number">0x3C</span>)) &#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="built_in">F</span>(<span class="string">&quot;SSD1306 初始化失敗！&quot;</span>));</span><br><span class="line">    <span class="keyword">for</span> (;;); <span class="comment">// 初始化失敗則停止</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;SSD1306 初始化成功&quot;</span>);</span><br><span class="line">  display.<span class="built_in">clearDisplay</span>();</span><br><span class="line">  display.<span class="built_in">display</span>();</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 初始化 MAX30102</span></span><br><span class="line">  <span class="keyword">if</span> (!particleSensor.<span class="built_in">begin</span>(Wire, I2C_SPEED_FAST)) &#123;</span><br><span class="line">    Serial.<span class="built_in">println</span>(<span class="string">&quot;找不到 MAX30102！請檢查連線。&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (;;); <span class="comment">// 初始化失敗則停止</span></span><br><span class="line">  &#125;</span><br><span class="line">  Serial.<span class="built_in">println</span>(<span class="string">&quot;MAX30102 初始化成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 配置 MAX30102</span></span><br><span class="line">  byte ledBrightness = <span class="number">0x7F</span>; <span class="comment">// 亮度: 127 (0=關閉, 255=50mA)</span></span><br><span class="line">  byte sampleAverage = <span class="number">4</span>; <span class="comment">// 平均樣本數: 1, 2, 4, 8, 16, 32</span></span><br><span class="line">  byte ledMode = <span class="number">2</span>; <span class="comment">// 模式: 2 (紅光+紅外線，用於血氧)</span></span><br><span class="line">  <span class="type">int</span> sampleRate = <span class="number">800</span>; <span class="comment">// 採樣率: 50, 100, 200, 400, 800, 1000, 1600, 3200</span></span><br><span class="line">  <span class="type">int</span> pulseWidth = <span class="number">215</span>; <span class="comment">// 脈寬: 69, 118, 215, 411</span></span><br><span class="line">  <span class="type">int</span> adcRange = <span class="number">16384</span>; <span class="comment">// ADC範圍: 2048, 4096, 8192, 16384</span></span><br><span class="line">  particleSensor.<span class="built_in">setup</span>(ledBrightness, sampleAverage, ledMode, sampleRate, pulseWidth, adcRange);</span><br><span class="line">  particleSensor.<span class="built_in">enableDIETEMPRDY</span>();</span><br><span class="line">  particleSensor.<span class="built_in">setPulseAmplitudeRed</span>(<span class="number">0x0A</span>); <span class="comment">// 低紅光 LED 表示感測器運行</span></span><br><span class="line">  particleSensor.<span class="built_in">setPulseAmplitudeGreen</span>(<span class="number">0</span>); <span class="comment">// 禁用綠光 LED</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">long</span> irValue = particleSensor.<span class="built_in">getIR</span>(); <span class="comment">// 讀取紅外線值以檢測手指</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (irValue &gt; FINGER_ON) &#123;</span><br><span class="line">    <span class="comment">// 檢查心跳</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">checkForBeat</span>(irValue) == <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="comment">// 顯示心跳動畫</span></span><br><span class="line">      display.<span class="built_in">clearDisplay</span>();</span><br><span class="line">      display.<span class="built_in">drawBitmap</span>(<span class="number">0</span>, <span class="number">0</span>, logo3_bmp, <span class="number">32</span>, <span class="number">32</span>, WHITE); <span class="comment">// 大心跳圖示</span></span><br><span class="line">      display.<span class="built_in">setTextSize</span>(<span class="number">2</span>);</span><br><span class="line">      display.<span class="built_in">setTextColor</span>(SSD1306_WHITE);</span><br><span class="line">      display.<span class="built_in">setCursor</span>(<span class="number">42</span>, <span class="number">10</span>);</span><br><span class="line">      display.<span class="built_in">print</span>(beatAvg);</span><br><span class="line">      display.<span class="built_in">println</span>(<span class="string">&quot; BPM&quot;</span>);</span><br><span class="line">      display.<span class="built_in">drawBitmap</span>(<span class="number">0</span>, <span class="number">35</span>, O2_bmp, <span class="number">32</span>, <span class="number">32</span>, WHITE); <span class="comment">// 氧氣圖示</span></span><br><span class="line">      display.<span class="built_in">setCursor</span>(<span class="number">42</span>, <span class="number">40</span>);</span><br><span class="line">      <span class="keyword">if</span> (beatAvg &gt; <span class="number">30</span>) display.<span class="built_in">print</span>(<span class="built_in">String</span>(ESpO2) + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">      <span class="keyword">else</span> display.<span class="built_in">print</span>(<span class="string">&quot;---- %&quot;</span>);</span><br><span class="line">      display.<span class="built_in">display</span>();</span><br><span class="line"></span><br><span class="line">      <span class="type">long</span> delta = <span class="built_in">millis</span>() - lastBeat;</span><br><span class="line">      lastBeat = <span class="built_in">millis</span>();</span><br><span class="line">      beatsPerMinute = <span class="number">60</span> / (delta / <span class="number">1000.0</span>);</span><br><span class="line">      <span class="keyword">if</span> (beatsPerMinute &lt; <span class="number">255</span> &amp;&amp; beatsPerMinute &gt; <span class="number">20</span>) &#123;</span><br><span class="line">        rates[rateSpot++] = (byte)beatsPerMinute;</span><br><span class="line">        rateSpot %= RATE_SIZE;</span><br><span class="line">        beatAvg = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (byte x = <span class="number">0</span>; x &lt; RATE_SIZE; x++) beatAvg += rates[x];</span><br><span class="line">        beatAvg /= RATE_SIZE;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 計算血氧</span></span><br><span class="line">    <span class="type">uint32_t</span> ir, red;</span><br><span class="line">    <span class="type">double</span> fred, fir;</span><br><span class="line">    particleSensor.<span class="built_in">check</span>(); <span class="comment">// 讀取最多 3 個樣本</span></span><br><span class="line">    <span class="keyword">if</span> (particleSensor.<span class="built_in">available</span>()) &#123;</span><br><span class="line">      i++;</span><br><span class="line">      ir = particleSensor.<span class="built_in">getFIFOIR</span>(); <span class="comment">// 讀取紅外線</span></span><br><span class="line">      red = particleSensor.<span class="built_in">getFIFORed</span>(); <span class="comment">// 讀取紅光</span></span><br><span class="line">      fir = (<span class="type">double</span>)ir;</span><br><span class="line">      fred = (<span class="type">double</span>)red;</span><br><span class="line">      aveir = aveir * frate + fir * (<span class="number">1.0</span> - frate); <span class="comment">// 紅外線低通濾波</span></span><br><span class="line">      avered = avered * frate + fred * (<span class="number">1.0</span> - frate); <span class="comment">// 紅光低通濾波</span></span><br><span class="line">      sumirrms += (fir - aveir) * (fir - aveir); <span class="comment">// 紅外線交流成分平方和</span></span><br><span class="line">      sumredrms += (fred - avered) * (fred - avered); <span class="comment">// 紅光交流成分平方和</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((i % Num) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">double</span> R = (<span class="built_in">sqrt</span>(sumirrms) / aveir) / (<span class="built_in">sqrt</span>(sumredrms) / avered);</span><br><span class="line">        SpO2 = <span class="number">-23.3</span> * (R - <span class="number">0.4</span>) + <span class="number">120</span>;</span><br><span class="line">        ESpO2 = FSpO2 * ESpO2 + (<span class="number">1.0</span> - FSpO2) * SpO2; <span class="comment">// 低通濾波</span></span><br><span class="line">        <span class="keyword">if</span> (ESpO2 &lt;= MINIMUM_SPO2) ESpO2 = MINIMUM_SPO2;</span><br><span class="line">        <span class="keyword">if</span> (ESpO2 &gt; <span class="number">100</span>) ESpO2 = <span class="number">99.9</span>;</span><br><span class="line">        sumredrms = <span class="number">0.0</span>; sumirrms = <span class="number">0.0</span>; SpO2 = <span class="number">0</span>;</span><br><span class="line">        i = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      particleSensor.<span class="built_in">nextSample</span>(); <span class="comment">// 移至下一個樣本</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 輸出到序列監視器</span></span><br><span class="line">    Serial.<span class="built_in">print</span>(<span class="string">&quot;Bpm: &quot;</span> + <span class="built_in">String</span>(beatAvg));</span><br><span class="line">    <span class="keyword">if</span> (beatAvg &gt; <span class="number">30</span>) Serial.<span class="built_in">println</span>(<span class="string">&quot;, SpO2: &quot;</span> + <span class="built_in">String</span>(ESpO2));</span><br><span class="line">    <span class="keyword">else</span> Serial.<span class="built_in">println</span>(<span class="string">&quot;, SpO2: ----&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新 OLED 穩定顯示</span></span><br><span class="line">    display.<span class="built_in">clearDisplay</span>();</span><br><span class="line">    display.<span class="built_in">drawBitmap</span>(<span class="number">5</span>, <span class="number">5</span>, logo2_bmp, <span class="number">24</span>, <span class="number">21</span>, WHITE); <span class="comment">// 小心跳圖示</span></span><br><span class="line">    display.<span class="built_in">setTextSize</span>(<span class="number">2</span>);</span><br><span class="line">    display.<span class="built_in">setTextColor</span>(SSD1306_WHITE);</span><br><span class="line">    display.<span class="built_in">setCursor</span>(<span class="number">42</span>, <span class="number">10</span>);</span><br><span class="line">    display.<span class="built_in">print</span>(beatAvg);</span><br><span class="line">    display.<span class="built_in">println</span>(<span class="string">&quot; BPM&quot;</span>);</span><br><span class="line">    display.<span class="built_in">drawBitmap</span>(<span class="number">0</span>, <span class="number">35</span>, O2_bmp, <span class="number">32</span>, <span class="number">32</span>, WHITE); <span class="comment">// 氧氣圖示</span></span><br><span class="line">    display.<span class="built_in">setCursor</span>(<span class="number">42</span>, <span class="number">40</span>);</span><br><span class="line">    <span class="keyword">if</span> (beatAvg &gt; <span class="number">30</span>) display.<span class="built_in">print</span>(<span class="built_in">String</span>(ESpO2) + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> display.<span class="built_in">print</span>(<span class="string">&quot;---- %&quot;</span>);</span><br><span class="line">    display.<span class="built_in">display</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 未偵測到手指，重置數據並顯示提示</span></span><br><span class="line">    <span class="keyword">for</span> (byte rx = <span class="number">0</span>; rx &lt; RATE_SIZE; rx++) rates[rx] = <span class="number">0</span>;</span><br><span class="line">    beatAvg = <span class="number">0</span>; rateSpot = <span class="number">0</span>; lastBeat = <span class="number">0</span>;</span><br><span class="line">    avered = <span class="number">0</span>; aveir = <span class="number">0</span>; sumirrms = <span class="number">0</span>; sumredrms = <span class="number">0</span>;</span><br><span class="line">    SpO2 = <span class="number">0</span>; ESpO2 = <span class="number">90.0</span>;</span><br><span class="line">    display.<span class="built_in">clearDisplay</span>();</span><br><span class="line">    display.<span class="built_in">setTextSize</span>(<span class="number">2</span>);</span><br><span class="line">    display.<span class="built_in">setTextColor</span>(SSD1306_WHITE);</span><br><span class="line">    display.<span class="built_in">setCursor</span>(<span class="number">30</span>, <span class="number">5</span>);</span><br><span class="line">    display.<span class="built_in">println</span>(<span class="string">&quot;Finger&quot;</span>);</span><br><span class="line">    display.<span class="built_in">setCursor</span>(<span class="number">30</span>, <span class="number">35</span>);</span><br><span class="line">    display.<span class="built_in">println</span>(<span class="string">&quot;Please&quot;</span>);</span><br><span class="line">    display.<span class="built_in">display</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="未來計劃"><a href="#未來計劃" class="headerlink" title="未來計劃"></a>未來計劃</h2><ul><li>圖表展示</li><li>記錄數據。</li><li>使用 AI 模型（如簡單神經網路）檢測心律不整 [使用 TensorFlow Lite 載入預訓練模型（例如簡單 MLP 模型）檢測異常。]</li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者:</span> <span class="post-copyright-info"><a href="https://victor999p.github.io">Victor999p</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章連結:</span> <span class="post-copyright-info"><a href="https://victor999p.github.io/posts/c2e18503.html">https://victor999p.github.io/posts/c2e18503.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版權聲明:</span> <span class="post-copyright-info">除特別聲明外，本博客所有文章均採用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 授權協議。轉載請註明出處：<a href="https://victor999p.github.io">一個在成長路上前行的人</a>。</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ESP32-S3/">ESP32-S3</a><a class="post-meta__tags" href="/tags/Arduino/">Arduino</a><a class="post-meta__tags" href="/tags/%E5%85%A5%E9%96%80/">入門</a></div><div class="post-share"><div class="social-share" data-image="/img/vertin_2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/6778c1a2.html" title="Biomedical Signals and Systems | 生物信號與生物系統 *UNFINISHED"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/37_2.jpg" onerror='onerror=null,src="/img/37.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一頁</div><div class="info-item-2">Biomedical Signals and Systems | 生物信號與生物系統 *UNFINISHED</div></div><div class="info-2"><div class="info-item-1">Introduction to Biosignals and Biological Systems | 生物信號與生物系統簡介Course Overview | 課程概述This course explores biosignals and biological systems, focusing on their roles in physiological processes, measurement, and analysis. Students will learn how biosignals facilitate communication within biological systems, how these signals are processed, and how tools like MATLAB can be used to simulate signal acquisition and conversion. The course bridges biology, engineering, and data analysis to understand...</div></div></div></a><a class="pagination-related" href="/posts/f5cdc6c3.html" title="Biomaterials-2 | 生物材料-2"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/37_3.jpg" onerror='onerror=null,src="/img/37.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一頁</div><div class="info-item-2">Biomaterials-2 | 生物材料-2</div></div><div class="info-2"><div class="info-item-1">Lecture 2: Surface and Bulk Properties of BiomaterialsLecture Introduction Title: Surface and Bulk Properties of Biomaterials Three Aspects in Biomaterials Aspects: Biological materials or body Implant materials Interaction between the two in the body Surface and Bulk Properties Overview Surface Properties: Surface contact angle Scanning Electron Microscopy (SEM) Electron Spectroscopy for Chemical Analysis (ESCA or XPS) Time-of-Flight Secondary Ion Mass Spectrometry (TOF-SIMS) Raman spect...</div></div></div></a></nav><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>評論</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/vertin.gif" onerror='this.onerror=null,this.src="/img/vertin.gif"' alt="avatar"></div><div class="author-info-name">Victor999p</div><div class="author-info-description">科技是工具，成長是旅程，自我提升是信念。</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Victor999p"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Victor999p" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a><a class="social-icon" href="mailto:4cvictor77@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color:#4a7dbe"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">此博客是我記錄課程學習和程式設計實驗的空間</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目錄</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ESP32-S3-%E5%85%A5%E9%96%80%EF%BC%9A%E5%AE%89%E8%A3%9D%E7%92%B0%E5%A2%83%E8%88%87-Hello-World"><span class="toc-number">1.</span> <span class="toc-text">ESP32-S3 入門：安裝環境與 Hello World</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%A9%9F-1-%E7%A1%AC%E9%AB%94%E6%BA%96%E5%82%99"><span class="toc-number">1.1.</span> <span class="toc-text">步驟 1: 硬體準備</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%A9%9F-2-%E5%AE%89%E8%A3%9D-Arduino-IDE"><span class="toc-number">1.2.</span> <span class="toc-text">步驟 2: 安裝 Arduino IDE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%A9%9F-3-%E7%A8%8B%E5%BC%8F%E7%A2%BC%E7%AF%84%E4%BE%8B-Hello-World"><span class="toc-number">1.3.</span> <span class="toc-text">步驟 3: 程式碼範例 - Hello World!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%A9%9F-4-%E8%88%87MAX30102-%E5%92%8C-SSD1106-OLED-%E7%9A%84%E6%95%B4%E5%90%88"><span class="toc-number">1.4.</span> <span class="toc-text">步驟 4: 與MAX30102 和 SSD1106 OLED 的整合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BC%8F%E7%A2%BC%E8%A7%A3%E9%87%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">程式碼解釋</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%A1%AC%E9%AB%94%E9%80%A3%E7%B7%9A"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">1. 硬體連線</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%A8%8B%E5%BC%8F%E7%A2%BC%E7%B5%90%E6%A7%8B"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">2. 程式碼結構</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%95%8F%E9%A1%8C%E6%8E%92%E6%9F%A5"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">3. 問題排查</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AA%E4%BE%86%E8%A8%88%E5%8A%83"><span class="toc-number">1.5.</span> <span class="toc-text">未來計劃</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/0.html" title="無標題"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/flutterpage.jpg" onerror='this.onerror=null,this.src="/img/37.jpg"' alt="無標題"></a><div class="content"><a class="title" href="/posts/0.html" title="無標題">無標題</a><time datetime="2025-10-05T06:45:24.910Z" title="發表於 2025-10-05 14:45:24">2025-10-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/170228b7.html" title="Biomaterials-4 | 生物材料-4"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/vertin_2.jpg" onerror='this.onerror=null,this.src="/img/37.jpg"' alt="Biomaterials-4 | 生物材料-4"></a><div class="content"><a class="title" href="/posts/170228b7.html" title="Biomaterials-4 | 生物材料-4">Biomaterials-4 | 生物材料-4</a><time datetime="2025-10-04T16:00:00.000Z" title="發表於 2025-10-05 00:00:00">2025-10-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8f57aec0.html" title="Biomaterials-5 | 生物材料-5"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/37_2.jpg" onerror='this.onerror=null,this.src="/img/37.jpg"' alt="Biomaterials-5 | 生物材料-5"></a><div class="content"><a class="title" href="/posts/8f57aec0.html" title="Biomaterials-5 | 生物材料-5">Biomaterials-5 | 生物材料-5</a><time datetime="2025-10-04T16:00:00.000Z" title="發表於 2025-10-05 00:00:00">2025-10-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c2e18503.html" title="ESP32-S3 與心跳和血氧測試"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/vertin_2.jpg" onerror='this.onerror=null,this.src="/img/37.jpg"' alt="ESP32-S3 與心跳和血氧測試"></a><div class="content"><a class="title" href="/posts/c2e18503.html" title="ESP32-S3 與心跳和血氧測試">ESP32-S3 與心跳和血氧測試</a><time datetime="2025-10-01T09:55:00.000Z" title="發表於 2025-10-01 17:55:00">2025-10-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6778c1a2.html" title="Biomedical Signals and Systems | 生物信號與生物系統 *UNFINISHED"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/37_2.jpg" onerror='this.onerror=null,this.src="/img/37.jpg"' alt="Biomedical Signals and Systems | 生物信號與生物系統 *UNFINISHED"></a><div class="content"><a class="title" href="/posts/6778c1a2.html" title="Biomedical Signals and Systems | 生物信號與生物系統 *UNFINISHED">Biomedical Signals and Systems | 生物信號與生物系統 *UNFINISHED</a><time datetime="2025-10-01T09:55:00.000Z" title="發表於 2025-10-01 17:55:00">2025-10-01</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/vertin_2.jpg)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Victor999p</span><span class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主題</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="閱讀模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="簡繁轉換">繁</button><button id="darkmode" type="button" title="切換日夜模式"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="單欄與雙欄切換"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="設定"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目錄"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往評論"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到頂部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-e2qw.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo-e2qw.vercel.app/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><div class="aplayer no-destroy" data-id="12749739110" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      true
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜尋</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>正在加載數據庫</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜尋文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><div class="app-refresh" id="app-refresh" style="position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease"><div class="app-refresh-wrap" style="display:flex;color:#fff;height:100%;align-items:center;justify-content:center"><label>✨ 有新文章啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color:#fff;text-decoration:underline;cursor:pointer">🍗点击食用🍔</span></a></div></div><script>if ('serviceWorker' in navigator) {
if (navigator.serviceWorker.controller) {
navigator.serviceWorker.addEventListener('controllerchange', function() {
showNotification()
})
}
window.addEventListener('load', function() {
navigator.serviceWorker.register('/sw.js')
})
}
function showNotification() {
if (GLOBAL_CONFIG.Snackbar) {
var snackbarBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
GLOBAL_CONFIG.Snackbar.bgLight :
GLOBAL_CONFIG.Snackbar.bgDark
var snackbarPos = GLOBAL_CONFIG.Snackbar.position
Snackbar.show({
text: '✨ 有新文章啦！ 👉',
backgroundColor: snackbarBg,
duration: 500000,
pos: snackbarPos,
actionText: '🍗点击食用🍔',
actionTextColor: '#fff',
onActionClick: function(e) {
location.reload()
},
})
} else {
var showBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
'#3b70fc' :
'#1f1f1f'
var cssText = `top: 0; background: ${showBg};`
document.getElementById('app-refresh').style.cssText = cssText
}
}</script></div><script data-pjax>function butterfly_clock_anzhiyu_injector_config(){var a=document.getElementsByClassName("sticky_layout")[0];console.log("已挂载butterfly_clock_anzhiyu"),a&&a.insertAdjacentHTML("afterbegin",'<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>')}for(var elist="null".split(","),cpage=location.pathname,epage="all",qweather_key="adca9ac161bb4e8ebbe477f93b808328",gaud_map_key="eadccb059f2ceb539f7357165a8153e8",baidu_ak_key="undefined",flag=0,clock_rectangle="112.6534116,27.96920845",clock_default_rectangle_enable="false",i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;"all"===epage&&0==flag?butterfly_clock_anzhiyu_injector_config():epage===cpage&&butterfly_clock_anzhiyu_injector_config()</script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="/js/clock.min.js"></script><script data-pjax>function butterfly_footer_beautify_injector_config(){var A=document.getElementById("footer-wrap");console.log("已挂载butterfly_footer_beautify"),A.insertAdjacentHTML("beforeend",'<div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v7.3.0" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v5.4.3" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" data-title="本站使用JsDelivr为静态资源提供CDN加速" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>')}for(var elist="null".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;"all"===epage&&0==flag?butterfly_footer_beautify_injector_config():epage===cpage&&butterfly_footer_beautify_injector_config()</script><script async src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/js/runtime/runtime.min.js"></script><script async src="/js/ali_font.js"></script><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","30"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("flink-list-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("article-sort-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__slideInRight"),arr[i].setAttribute("data-wow-duration","1.5s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__flipInY"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("site-card"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__animated"),arr[i].setAttribute("data-wow-duration","3s"),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/koharu.model.json"},display:{position:"left",width:150,height:300},mobile:{show:!1},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/"})</script></body></html>